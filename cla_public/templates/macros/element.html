{#
  Generic alert element

  Params:
    - type <string> (default: info)
        Type of alert (sets CSS class `alert-{type}`)
    - icon <string> (default: none)
        Alert icon (sets CSS class `icon-{icon}`)
    - title <string> (default: None)
        Alert title
#}
{% macro alert(type='info', icon=None, title=None) %}
  {% if type == 'error' %}
    <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
      {% if title %}
        <h2 class="govuk-error-summary__title" id="error-summary-title">{{ _(title) }}</h2>
      {% else %}
        <h2 class="govuk-error-summary__title" id="error-summary-title">{{ _('There is a problem') }}</h2>
      {% endif %}
      <div class="govuk-error-summary__body">
        {{ caller() }}
      </div>
    </div>
  {% else %}
    <div class="alert alert-{{type}}"
      role="alert"
      {% if title %}aria-labelledby="alert-heading-{{type}}"{% endif %}
    >
      {% if icon %}
        <span class="icon icon-{{icon}}" aria-hidden="true"></span>
      {% endif %}
      <div class="alert-message">
        {% if title %}
          <h3 class="alert-header" id="alert-heading-{{type}}">{{ _(title) }}</h3>
        {% endif %}
        {{ caller() }}
      </div>
    </div>
  {% endif %}
{% endmacro %}

{% macro inset() %}
  <div class="govuk-inset-text">
    {{ caller() }}
  </div>
{% endmacro %}


{#
  'get in touch' link to contact page
#}
{% macro get_in_touch_link() %}
  <p id="aria-get-in-touch" class="get-in-touch">
    {{ _('If you’re having trouble completing this form') }},
    <a href="{{ url_for('base.reasons_for_contacting') }}" id="callback-link" class="govuk-link">
      {{ _('get in touch') }}</a>.
  </p>
{% endmacro %}

{#
  Prompt to complete the satisfaction survey on gov.uk
#}
{%  macro satisfaction_survey_prompt() %}
  {% call alert(title=_('What do you think about this service?')) %}
    <p id="aria-satisfaction-survey">
      {% trans -%}
        Your feedback will improve this service. Please <a class="govuk-link" href="https://www.gov.uk/done/check-if-civil-legal-advice-can-help-you">send us your thoughts</a>.
      {%- endtrans %}
    </p>
  {% endcall %}
{% endmacro %}


{#
  Progress bar

  Params:
    - current <Number>
    - completed <Number>
#}

{%  macro progress_bar(current, completed, offset=-5) %}
  {% if current is number or completed is number %}
    <div class="progress-bar">
      {% if completed %}
        <div class="progress-value m-completed" style="width:{{ completed + offset }}%;"></div>
      {% endif %}
      {% if current %}
        <div class="progress-value m-current" style="left:{{ current + offset }}%;"></div>
      {% endif %}
    </div>
  {% endif %}
{% endmacro %}


{#
  staying safe online link
#}

{% macro staying_safe_online_link() %}
  <p id="aria-staying-safe-online">
    {%- set link=link_new_window(url_for('base.online_safety'), 'Staying safe online') -%}
    {%- trans -%}The information you enter won’t be stored on this device. Find out more about {{ link }}.{%- endtrans -%}
  </p>
{% endmacro %}


{#
  Renders anchor tag for links opening in a new window
#}

{% macro link_new_window(url, text, is_external=False) %}
  <a href="{{ url }}"
    {% if is_external %} rel="external"{% endif %}
    target="_blank"
    title="{{ _('Opens in new window') }}"
    {% if kwargs %}
      {% for attr in kwargs %}
        {% if attr == 'class' %}
          {% if kwargs[attr].startswith('govuk-button') %}
            role="button"
            class="govuk-link {{ kwargs[attr] }}"
          {% endif %}
        {% else %}
          class="govuk-link"
        {{ attr }}="{{ kwargs[attr] }}"
        {% endif %}
     {% endfor %}
    {% endif %}
  >
    {{ _(text) }}
    <span class="govuk-visually-hidden"> {{ _('Opens in new window') }}</span></a>
{%- endmacro %}

{% macro link_same_window(url, text, is_external=False) %}
  <a href="{{ url }}"
    class="govuk-link"
    {% if is_external %} rel="external"{% endif %}
    {% if kwargs %}
      {% for attr in kwargs %}
        {{ attr }}="{{ kwargs[attr] }}"
        {% if attr == 'class' %}
          {% if kwargs[attr].startswith('govuk-button') %}
            role="button"
          {% endif %}
        {% else %}
          class="govuk-link"
        {% endif %}
      {% endfor %}
    {% endif %}
  >
    {{ _(text) }}
{%- endmacro %}
